<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarbonX</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Figtree:ital,wght@0,300..900;1,300..900&family=Hammersmith+One&display=swap" rel="stylesheet">
    <link rel="icon" href="assets/CarbonX-icon(dark).png" type="image/png" media="(prefers-color-scheme: dark)">
    <link rel="icon" href="assets/CarbonX-icon(light).png" type="image/png" media="(prefers-color-scheme: light)">
<style>
    :root {
        color-scheme: light dark;
        --navy: #223f43;
        --blue: #59A5B2;
        --light-blue: #c5e4e7;
        --cream: #f1e0ce;
        --yellow: #fbcc58;
        --black: #020202;
        --white: #f4f4f4;
        --grey: #eaeaea;
        --dark-grey: #a9a9a9;
        --danger-color: #ef4444;
        --danger-hover-color: #dc2626;
        --body-bg: light-dark(var(--grey), var(--black));
        --card-bg: light-dark(var(--white), #1c1c1e);
        --border-color: light-dark(#e5e7eb, #3a3a3c);
        --text-dark: light-dark(var(--black), var(--white));
        --text-muted: light-dark(#6b7280, #8e8e93);
        --modal-bg: light-dark(var(--white), #2c2c2e);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Figtree', sans-serif; background-color: var(--body-bg); color: var(--text-dark); display: flex; height: 100vh; overflow: hidden; }
    .sidebar { width: 80px; background-color: var(--card-bg); padding: 30px 15px; display: flex; flex-direction: column; justify-content: space-between; border-right: 1px solid var(--border-color); flex-shrink: 0; transition: width 0.3s ease; overflow-x: hidden; }
    .sidebar.expanded { width: 240px; }
    .sidebar-top, .sidebar-bottom { display: flex; flex-direction: column; }
    .logo { display: flex; align-items: center; gap: 10px; margin-bottom: 50px; flex-shrink: 0; height: 30px; justify-content: center; }
    .nav-menu { display: flex; flex-direction: column; }
    .nav-item { display: flex; align-items: center; padding: 12px; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: background-color 0.2s, color 0.2s; font-weight: 500; color: var(--text-dark); text-decoration: none; white-space: nowrap; }
    .nav-item.active { background-color: light-dark(var(--navy), var(--blue)); color: light-dark(var(--white), var(--black)); }
    .nav-item:not(.active):hover { background-color: var(--border-color); }
    .nav-item svg { width: 24px; height: 24px; flex-shrink: 0; margin-right: 18px; }
    .nav-item span { opacity: 0; transition: opacity 0.2s; }
    .sidebar.expanded .nav-item span { opacity: 1; }
    .user-profile { display: flex; align-items: center; gap: 10px; padding-top: 20px; border-top: 1px solid var(--border-color); margin-top: 20px; text-decoration: none; color: inherit; }
    .user-avatar { width: 40px; height: 40px; border-radius: 50%; background-color: var(--dark-grey); color: var(--white); display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
    .user-info { opacity: 0; transition: opacity 0.2s; }
    .sidebar.expanded .user-info { opacity: 1; }
    .user-info .name { font-weight: 600; color: var(--text-dark); }
    .user-info .company { font-size: 12px; color: var(--text-muted); }
    .main-content { flex-grow: 1; padding: 40px; overflow-y: auto; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
    header .title h1 { font-size: 36px; color: var(--text-dark); font-weight: bold; }
    header .title p { color: var(--text-muted); margin-top: 5px; }
    .lca-status { font-size: 13px; color: var(--text-muted); margin-top: 10px; }
    .lca-status .dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 6px; }
    .lca-status .dot.connected { background-color: #10b981; }
    .lca-status .dot.disconnected { background-color: var(--danger-color); }
    header .actions { display: flex; gap: 15px; }
    .add-new-btn { background-color: var(--yellow); color: var(--black); border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; font-size: 14px; cursor: pointer; transition: background-color 0.2s; }
    .inventory-table { width: 100%; border-collapse: collapse; background-color: var(--card-bg); border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid var(--border-color); overflow: hidden; }
    .inventory-table th, .inventory-table td { text-align: left; padding: 16px; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
    .inventory-table th { font-weight: 500; font-size: 14px; color: var(--text-muted); }
    .inventory-table td { font-size: 14px; font-weight: 500; }
    .editable-weight { border: 1px solid var(--dark-grey); background-color: transparent; font-family: inherit; font-size: inherit; font-weight: inherit; color: inherit; padding: 4px; border-radius: 4px; width: 100px; transition: all 0.2s; }
    .editable-weight:focus { outline: none; border: 1px solid var(--blue); }
    .dpp-link { color: light-dark(var(--navy), var(--blue)); font-weight: bold; text-decoration: underline; cursor: pointer; }
    .view-file-btn { background-color: var(--light-blue); color: light-dark(var(--navy), var(--black)); font-weight: 600; padding: 6px 15px; border-radius: 6px; border: none; cursor: pointer; }
    .btn-delete { background-color: light-dark(#fee2e2, #5c2b2b); color: light-dark(#991b1b, #fca5a5); border: none; font-weight: 600; padding: 6px 15px; border-radius: 6px; cursor: pointer; }
    .lca-cell-content { display: flex; align-items: center; gap: 10px; min-height: 28px; }
    .lca-result-value { font-weight: 600; }
    .lca-status-text { font-style: italic; color: var(--text-muted); }
    .lca-status-text.error { color: var(--danger-color); font-weight: 600; }
    .loading { display: inline-block; width: 16px; height: 16px; border: 2px solid var(--border-color); border-top-color: var(--blue); border-radius: 50%; animation: spin 0.8s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: none; align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s; }
    .modal-overlay.active { display: flex; }
    .modal-content { background: var(--modal-bg); padding: 30px; border-radius: 16px; width: 100%; box-shadow: 0 10px 30px rgba(0,0,0,0.2); transform: scale(0.95); animation: slideDown 0.3s; color: var(--text-dark); }
    #addProductModal .modal-content, #confirmDeleteModal .modal-content { max-width: 450px; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
    .modal-header h2 { font-size: 24px; font-weight: 700; }
    .close-modal-btn { background: none; border: none; font-size: 30px; cursor: pointer; color: var(--text-muted); line-height: 1; }
    .modal-body { overflow-y: auto; }
    .modal-actions { margin-top: 25px; display: flex; justify-content: flex-end; gap: 12px; }
    .modal-btn { padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; }
    .btn-secondary { background-color: var(--body-bg); color: var(--text-dark); border: 1px solid var(--border-color); }
    .btn-danger { background-color: var(--danger-color); color: var(--white); }
    #addProductForm .form-group { margin-bottom: 20px; }
    #addProductForm label { font-weight: 600; font-size: 14px; margin-bottom: 8px; display: block; }
    #addProductForm input[type="text"], #addProductForm input[type="number"] { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; background-color: var(--card-bg); color: var(--text-dark); }
    .file-drop-area { border: 2px dashed var(--border-color); border-radius: 8px; padding: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; background-color: var(--body-bg); cursor: pointer; }
    .file-drop-area svg { width: 32px; height: 32px; margin-bottom: 10px; color: var(--text-muted); }
    .file-attached-info { font-size: 13px; color: var(--text-muted); margin-top: 10px; display: none; }
    .form-submit-btn { width: 100%; padding: 14px; background-color: var(--yellow); color: var(--black); font-weight: 700; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; margin-top: 10px; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideDown { from { transform: translateY(-30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
</style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-top">
        <div class="logo"><picture><source srcset="assets/CarbonX-icon(dark).png" media="(prefers-color-scheme: dark)"><img src="assets/CarbonX-icon(light).png" alt="Logo" width="30"></picture></div>
        <nav class="nav-menu">
            <a href="dashboard.html" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg><span>Dashboard</span></a>
            <a href="inventory.html" class="nav-item active"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg><span>Inventory</span></a>
            <a href="analytics.html" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg><span>Analytics</span></a>
            <a href="network.html" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg><span>Network</span></a>
            <a href="report.html" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg><span>Report</span></a>
            <a href="chat.html" class="nav-item"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg><span>AI Chat</span></a>
        </nav>
    </div>
    <div class="sidebar-bottom">
        <a href="settings.html" class="user-profile"><div class="user-avatar" id="user-avatar"></div><div class="user-info"><div class="name" id="user-name"></div><div class="company" id="user-company"></div></div></a>
    </div>
</div>

<main class="main-content">
    <header>
        <div class="title">
            <h1>Inventory</h1>
            <p>Overview of your products and their environmental impact.</p>
            <div class="lca-status"><span id="lcaStatusDot" class="dot disconnected"></span><strong>OpenLCA Status:</strong> <span id="lcaStatusText">Connecting...</span></div>
        </div>
        <div class="actions"><button class="add-new-btn">Add New</button></div>
    </header>
    <table class="inventory-table">
        <thead><tr><th>Product Name</th><th>Weight (kg)</th><th>DPP</th><th>kgCO2e (Climate Change)</th><th>File</th><th>Actions</th></tr></thead>
        <tbody></tbody>
    </table>
</main>

<div id="addProductModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h2>Add a New Product</h2><button class="close-modal-btn">&times;</button></div>
        <form id="addProductForm">
            <div class="form-group"><label for="productName">Product Name (must exactly match an OpenLCA process)</label><input type="text" id="productName" required></div>
            <div class="form-group"><label for="productWeight">Weight (kg)</label><input type="number" id="productWeight" step="0.01" required value="1"></div>
            <div class="form-group">
                <label>File (Optional)</label>
                <div class="file-drop-area">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.2 15c.7-1.2 1-2.5.7-3.9-.6-2.4-2.8-4-5.4-4-1.6 0-3.1.8-4.1 2.1-1.5-1.5-3.8-1.7-5.6-.5-2.1 1.4-2.9 4.1-1.9 6.3"></path><path d="M12 12v9"></path><path d="m16 16-4 4-4-4"></path></svg>
                    <span>Drag & drop or click to upload</span><input type="file" id="fileUpload" hidden>
                </div>
                <p class="file-attached-info">File Attached: <strong id="fileName"></strong></p>
            </div>
            <button type="submit" class="form-submit-btn">Add & Calculate LCA</button>
        </form>
    </div>
</div>

<div id="confirmDeleteModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header"><h2>Confirm Deletion</h2><button class="close-modal-btn">&times;</button></div>
        <div class="modal-body">
            <p>Are you sure you want to permanently delete this product? This action cannot be undone.</p>
            <p style="margin-top: 10px; font-weight: 600;" id="productNameToDelete"></p>
            <div class="modal-actions"><button id="cancelDeleteBtn" class="modal-btn btn-secondary">Cancel</button><button id="confirmDeleteBtn" class="modal-btn btn-danger">Confirm Delete</button></div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        let products = JSON.parse(sessionStorage.getItem('products')) || [];
        let fileStore = {}; 
        let productIdToDelete = null;
        const openLCA = { serverUrl: "http://localhost:8080", requestId: 1, data: [], methodId: null, categoryId: null, isReady: false };
        const tableBody = document.querySelector('.inventory-table tbody');
        const addProductModal = document.getElementById('addProductModal');
        const confirmDeleteModal = document.getElementById('confirmDeleteModal');
        const fileDropArea = document.querySelector('.file-drop-area');
        const fileInput = document.getElementById('fileUpload');
        const fileNameDisplay = document.getElementById('fileName');
        const fileAttachedInfo = document.querySelector('.file-attached-info');

        initializePage();
        async function initializePage() {
            initializeUserInterface();
            await initializeOpenLCAConnection();
            renderTable();
        }

        document.querySelector('.add-new-btn').addEventListener('click', () => addProductModal.classList.add('active'));
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal || e.target.classList.contains('close-modal-btn')) modal.classList.remove('active');
            });
        });
        
        fileDropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileNameDisplay.textContent = fileInput.files[0].name;
                fileAttachedInfo.style.display = 'block';
            }
        });
        
        document.getElementById('addProductForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const productName = document.getElementById('productName').value;
            const productWeight = parseFloat(document.getElementById('productWeight').value);
            const file = fileInput.files[0];
            
            if (productName && productWeight > 0) {
                const newProduct = { id: Date.now(), name: productName, weight: productWeight, fileName: file ? file.name : null, lcaStatus: 'calculating', lcaResult: null, lcaUnit: null, fullImpacts: null, inventory: null, processId: null };
                if (file) fileStore[newProduct.id] = file;
                products.push(newProduct);
                addProductModal.classList.remove('active');
                e.target.reset();
                fileAttachedInfo.style.display = 'none';
                renderTable();
                const result = await findAndCalculateLCA(newProduct);
                updateProductWithLCAResult(newProduct.id, result);
            }
        });

        tableBody.addEventListener('change', (e) => {
            if (e.target.classList.contains('editable-weight')) {
                const productId = parseInt(e.target.dataset.id, 10);
                const newWeight = parseFloat(e.target.value);
                const productIndex = products.findIndex(p => p.id === productId);
                if (productIndex > -1 && !isNaN(newWeight)) {
                    products[productIndex].weight = newWeight;
                    products[productIndex].lcaStatus = 'calculating';
                    renderTable();
                    findAndCalculateLCA(products[productIndex]).then(result => updateProductWithLCAResult(productId, result));
                }
            }
        });
        
        tableBody.addEventListener('click', (e) => {
            const target = e.target;
            if (target.classList.contains('view-file-btn')) {
                const file = fileStore[parseInt(target.dataset.id, 10)];
                if (file) window.open(URL.createObjectURL(file), '_blank');
                else alert("File is not available in this session.");
            }
            if (target.classList.contains('btn-delete')) {
                productIdToDelete = parseInt(target.dataset.id, 10);
                const product = products.find(p => p.id === productIdToDelete);
                if (product) {
                    document.getElementById('productNameToDelete').textContent = `"${escapeHtml(product.name)}"`;
                    confirmDeleteModal.classList.add('active');
                }
            }
        });

        document.getElementById('cancelDeleteBtn').addEventListener('click', () => { confirmDeleteModal.classList.remove('active'); productIdToDelete = null; });
        document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
            if (productIdToDelete !== null) deleteProduct(productIdToDelete);
            confirmDeleteModal.classList.remove('active');
            productIdToDelete = null;
        });

        function deleteProduct(productId) {
            products = products.filter(p => p.id !== productId);
            delete fileStore[productId];
            sessionStorage.setItem('products', JSON.stringify(products));
            renderTable();
        }

        function renderTable() {
            tableBody.innerHTML = products.length > 0 
                ? products.map(createProductRowHTML).join('')
                : `<tr><td colspan="6" style="text-align: center; padding: 40px;">No products yet. Click 'Add New' to start.</td></tr>`;
        }

        function createProductRowHTML(product) {
            let lcaCellHTML;
            switch(product.lcaStatus) {
                case 'calculating': lcaCellHTML = `<div class="loading"></div> <span class="lca-status-text">Calculating...</span>`; break;
                case 'success': lcaCellHTML = `<span class="lca-result-value">${parseFloat(product.lcaResult).toPrecision(3)} ${product.lcaUnit}</span>`; break;
                case 'not_found': lcaCellHTML = `<span class="lca-status-text error">Process not found</span>`; break;
                case 'error': lcaCellHTML = `<span class="lca-status-text error">Calculation Error</span>`; break;
                default: lcaCellHTML = `<span class="lca-status-text">Not calculated</span>`;
            }
            const fileCellHTML = product.fileName ? `<button class="view-file-btn" data-id="${product.id}">View File</button>` : `<span class="lca-status-text">No file</span>`;
            return `<tr>
                <td>${escapeHtml(product.name)}</td>
                <td><input type="number" class="editable-weight" value="${product.weight}" data-id="${product.id}" step="0.01"></td>
                <td><a href="#" class="dpp-link">View DPP</a></td>
                <td><div class="lca-cell-content">${lcaCellHTML}</div></td>
                <td>${fileCellHTML}</td>
                <td><button class="btn-delete" data-id="${product.id}">Delete</button></td>
            </tr>`;
        }

        async function findAndCalculateLCA(product) {
            if (!openLCA.isReady) return { lcaStatus: 'error' };
            const matchedProcess = openLCA.data.find(p => p.name?.toLowerCase().trim() === product.name.toLowerCase().trim());
            if (!matchedProcess) return { lcaStatus: 'not_found' };

            let resultId = null;
            try {
                const setup = await olcaRequest("result/calculate", {
                    target: { "@type": "Process", "@id": matchedProcess['@id'] },
                    impactMethod: { "@type": "ImpactMethod", "@id": openLCA.methodId },
                    amount: product.weight
                });
                resultId = setup['@id'];
                for (let i = 0; i < 40; i++) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    if ((await olcaRequest("result/state", { "@id": resultId })).isReady) break;
                }
                const [impacts, inventory] = await Promise.all([
                    olcaRequest("result/total-impacts", { "@id": resultId }),
                    olcaRequest("result/total-flows", { "@id": resultId })
                ]);
                const climateResult = impacts.find(r => r.impactCategory?.['@id'] === openLCA.categoryId);
                return { 
                    lcaStatus: 'success', 
                    lcaResult: climateResult.amount, 
                    lcaUnit: climateResult.impactCategory.refUnit, 
                    fullImpacts: impacts, 
                    inventory: inventory,
                    processId: matchedProcess['@id'] // <-- SAVE THE PROCESS ID HERE
                };
            } catch (error) {
                console.error(`LCA Calculation failed for ${product.name}:`, error);
                return { lcaStatus: 'error' };
            } finally {
                if (resultId) await olcaRequest("result/dispose", { "@id": resultId });
            }
        }
        
        function updateProductWithLCAResult(productId, result) {
            const index = products.findIndex(p => p.id === productId);
            if (index > -1) {
                products[index] = { ...products[index], ...result };
                sessionStorage.setItem('products', JSON.stringify(products));
                renderTable();
            }
        }
        
        async function initializeOpenLCAConnection(){try{await fetch(openLCA.serverUrl,{signal:AbortSignal.timeout(2000)});updateLcaStatus('connected','Ready');const e=await olcaRequest("data/get/descriptors",{"@type":"ImpactMethod"}),t=e.find(e=>e.name?.toLowerCase().includes("recipe 2016 v1.03")&&e.name?.toLowerCase().includes("midpoint (h)"));if(!t)throw new Error("RECIPE 2016 Midpoint (H) method not found.");openLCA.methodId=t["@id"];const a=await olcaRequest("data/get",{"@type":"ImpactMethod","@id":openLCA.methodId}),o=a.impactCategories.find(e=>e.name?.toLowerCase().includes("climate change"));if(!o)throw new Error("'Climate Change' category not found.");openLCA.categoryId=o["@id"];const n=await olcaRequest("data/get/descriptors",{"@type":"Process"});openLCA.data=n.map(e=>({...e,olcaType:"Process"})),openLCA.isReady=!0}catch(e){console.error("OpenLCA Initialization Failed:",e),updateLcaStatus('disconnected','Connection failed. Is OpenLCA running?')}}
        function updateLcaStatus(status,text){document.getElementById("lcaStatusDot").className=`dot ${status}`,document.getElementById("lcaStatusText").textContent=text}
        function initializeUserInterface(){const e=localStorage.getItem("signupFullName")||"John Doe",t=localStorage.getItem("companyName")||"Company Name";document.getElementById("user-name").textContent=e,document.getElementById("user-company").textContent=t;let a="JD";e&&(a=(nameParts=e.split(" "))[0].charAt(0)+(nameParts.length>1?nameParts[nameParts.length-1].charAt(0):"")),document.getElementById("user-avatar").textContent=a.toUpperCase();const o=document.querySelector(".sidebar");o.addEventListener("mouseenter",()=>o.classList.add("expanded")),o.addEventListener("mouseleave",()=>o.classList.remove("expanded"))}
        async function olcaRequest(method,params){const response=await fetch(openLCA.serverUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:openLCA.requestId++,method,params})});if(!response.ok)throw new Error(`HTTP error! status: ${response.status}`);const data=await response.json();if(data.error)throw new Error(`OpenLCA Error: ${data.error.message}`);return data.result}
        function escapeHtml(text) { return text?.toString().replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;") || ''; }
    });
</script>
</body>
</html>